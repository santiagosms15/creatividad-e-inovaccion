<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrar Finanzas</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 20px 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 30px;
      }

      .header h1 {
        color: #667eea;
        font-size: 2em;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .tab {
        padding: 12px 24px;
        background: #f0f0f0;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s;
      }

      .tab:hover {
        background: #e0e0e0;
      }

      .tab.active {
        background: #667eea;
        color: white;
      }

      .content-section {
        display: none;
      }

      .content-section.active {
        display: block;
      }

      .card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      .card h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #333;
        font-weight: 500;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        transition: border 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        padding: 12px 30px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }

      .btn-delete {
        background: #e74c3c;
        padding: 8px 16px;
        font-size: 0.9em;
      }

      .btn-delete:hover {
        background: #c0392b;
      }

      .expense-item,
      .goal-item,
      .budget-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .expense-info {
        flex: 1;
      }

      .expense-category {
        display: inline-block;
        padding: 4px 12px;
        background: #667eea;
        color: white;
        border-radius: 15px;
        font-size: 0.85em;
        margin-right: 10px;
      }

      .expense-amount {
        font-size: 1.2em;
        font-weight: bold;
        color: #e74c3c;
      }

      .goal-amount {
        font-size: 1.2em;
        font-weight: bold;
        color: #27ae60;
      }

      .progress-bar {
        width: 100%;
        height: 25px;
        background: #e0e0e0;
        border-radius: 15px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.5s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.9em;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .stat-card h3 {
        font-size: 0.9em;
        opacity: 0.9;
        margin-bottom: 10px;
      }

      .stat-card .value {
        font-size: 2em;
        font-weight: bold;
      }

      .chart-container {
        margin-top: 20px;
      }

      .category-bar {
        margin-bottom: 15px;
      }

      .category-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .bar {
        height: 30px;
        background: #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
      }

      .bar-fill {
        height: 100%;
        background: #667eea;
        transition: width 0.5s;
        display: flex;
        align-items: center;
        padding-left: 10px;
        color: white;
        font-weight: bold;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .alert-warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
      }

      .alert-success {
        background: #d4edda;
        border-left: 4px solid #28a745;
        color: #155724;
      }

      .tips-list {
        list-style: none;
      }

      .tips-list li {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
      }

      .tips-list li::before {
        content: "üí° ";
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üí∞ Administrar Finanzas</h1>
        <div class="tabs">
          <button class="tab active" onclick="showTab('gastos')">
            Registro de Gastos
          </button>
          <button class="tab" onclick="showTab('presupuesto')">
            Presupuesto Mensual
          </button>
          <button class="tab" onclick="showTab('objetivos')">
            Objetivos de Ahorro
          </button>
          <button class="tab" onclick="showTab('analisis')">An√°lisis</button>
          <button class="tab" onclick="showTab('consejos')">Consejos</button>
        </div>
      </div>

      <!-- Registro de Gastos -->
      <div id="gastos" class="content-section active">
        <div class="card">
          <h2>Registrar Nuevo Gasto</h2>
          <div class="form-group">
            <label>Descripci√≥n:</label>
            <input
              type="text"
              id="gastoDesc"
              placeholder="Ej: Compra de supermercado"
            />
          </div>
          <div class="form-group">
            <label>Monto:</label>
            <input type="number" id="gastoMonto" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label>Categor√≠a:</label>
            <select id="gastoCategoria">
              <option value="Comida">üçî Comida</option>
              <option value="Transporte">üöó Transporte</option>
              <option value="Entretenimiento">üéÆ Entretenimiento</option>
              <option value="Servicios">üí° Servicios</option>
              <option value="Salud">üíä Salud</option>
              <option value="Educaci√≥n">üìö Educaci√≥n</option>
              <option value="Ropa">üëï Ropa</option>
              <option value="Otros">üì¶ Otros</option>
            </select>
          </div>
          <div class="form-group">
            <label>Fecha:</label>
            <input type="date" id="gastoFecha" />
          </div>
          <button class="btn" onclick="agregarGasto()">Agregar Gasto</button>
        </div>

        <div class="card">
          <h2>Historial de Gastos</h2>
          <div id="listaGastos"></div>
        </div>
      </div>

      <!-- Presupuesto Mensual -->
      <div id="presupuesto" class="content-section">
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Presupuesto Total</h3>
            <div class="value" id="presupuestoTotal">$0</div>
          </div>
          <div class="stat-card">
            <h3>Gastado Este Mes</h3>
            <div class="value" id="gastadoMes">$0</div>
          </div>
          <div class="stat-card">
            <h3>Disponible</h3>
            <div class="value" id="disponible">$0</div>
          </div>
        </div>

        <div class="card">
          <h2>Configurar Presupuesto por Categor√≠a</h2>
          <div class="form-group">
            <label>Categor√≠a:</label>
            <select id="presupuestoCategoria">
              <option value="Comida">üçî Comida</option>
              <option value="Transporte">üöó Transporte</option>
              <option value="Entretenimiento">üéÆ Entretenimiento</option>
              <option value="Servicios">üí° Servicios</option>
              <option value="Salud">üíä Salud</option>
              <option value="Educaci√≥n">üìö Educaci√≥n</option>
              <option value="Ropa">üëï Ropa</option>
              <option value="Otros">üì¶ Otros</option>
            </select>
          </div>
          <div class="form-group">
            <label>L√≠mite Mensual:</label>
            <input type="number" id="presupuestoLimite" placeholder="0.00" />
          </div>
          <button class="btn" onclick="establecerPresupuesto()">
            Establecer Presupuesto
          </button>
        </div>

        <div class="card">
          <h2>Estado del Presupuesto</h2>
          <div id="estadoPresupuesto"></div>
        </div>
      </div>

      <!-- Objetivos de Ahorro -->
      <div id="objetivos" class="content-section">
        <div class="card">
          <h2>Crear Nuevo Objetivo</h2>
          <div class="form-group">
            <label>Nombre del Objetivo:</label>
            <input
              type="text"
              id="objetivoNombre"
              placeholder="Ej: Comprar laptop"
            />
          </div>
          <div class="form-group">
            <label>Monto Objetivo:</label>
            <input type="number" id="objetivoMonto" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label>Monto Actual Ahorrado:</label>
            <input type="number" id="objetivoActual" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label>Fecha L√≠mite:</label>
            <input type="date" id="objetivoFecha" />
          </div>
          <div class="form-group">
            <label>Prioridad:</label>
            <select id="objetivoPrioridad">
              <option value="Alta">üî¥ Alta</option>
              <option value="Media">üü° Media</option>
              <option value="Baja">üü¢ Baja</option>
            </select>
          </div>
          <button class="btn" onclick="agregarObjetivo()">
            Crear Objetivo
          </button>
        </div>

        <div class="card">
          <h2>Mis Objetivos de Ahorro</h2>
          <div id="listaObjetivos"></div>
        </div>
      </div>

      <!-- An√°lisis -->
      <div id="analisis" class="content-section">
        <div class="card">
          <h2>An√°lisis de Gastos por Categor√≠a</h2>
          <div class="chart-container" id="chartGastos"></div>
        </div>

        <div class="card">
          <h2>Viabilidad de Objetivos</h2>
          <div id="viabilidadObjetivos"></div>
        </div>

        <div class="card">
          <h2>Resumen Financiero</h2>
          <div class="form-group">
            <label>Ingreso Mensual:</label>
            <input type="number" id="ingresoMensual" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label>Gastos Fijos:</label>
            <input type="number" id="gastosFijos" placeholder="0.00" />
          </div>
          <button class="btn" onclick="calcularViabilidad()">Analizar</button>
          <div id="resultadoAnalisis" style="margin-top: 20px"></div>
        </div>
      </div>

      <!-- Consejos -->
      <div id="consejos" class="content-section">
        <div class="card">
          <h2>Consejos Personalizados</h2>
          <ul class="tips-list" id="listaConsejos">
            <li>
              Registra todos tus gastos diariamente para tener un mejor control.
            </li>
            <li>Establece un presupuesto para cada categor√≠a y resp√©talo.</li>
            <li>Intenta ahorrar al menos el 20% de tus ingresos mensuales.</li>
            <li>Revisa tus suscripciones y cancela las que no uses.</li>
            <li>
              Usa el m√©todo 50/30/20: 50% necesidades, 30% deseos, 20% ahorros.
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      // Datos en memoria
      let gastos = [];
      let presupuestos = {};
      let objetivos = [];

      // Inicializar fecha actual
      document.getElementById("gastoFecha").valueAsDate = new Date();

      // Funciones para tabs
      function showTab(tabName) {
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.getElementById(tabName).classList.add("active");
        event.target.classList.add("active");

        if (tabName === "presupuesto") {
          actualizarEstadoPresupuesto();
        } else if (tabName === "analisis") {
          actualizarAnalisis();
        } else if (tabName === "consejos") {
          generarConsejos();
        }
      }

      // Funciones de Gastos
      function agregarGasto() {
        const desc = document.getElementById("gastoDesc").value;
        const monto = parseFloat(document.getElementById("gastoMonto").value);
        const categoria = document.getElementById("gastoCategoria").value;
        const fecha = document.getElementById("gastoFecha").value;

        if (!desc || !monto || !fecha) {
          alert("Por favor completa todos los campos");
          return;
        }

        const gasto = { desc, monto, categoria, fecha, id: Date.now() };
        gastos.push(gasto);

        document.getElementById("gastoDesc").value = "";
        document.getElementById("gastoMonto").value = "";

        mostrarGastos();
        verificarPresupuesto(categoria, monto);
      }

      function mostrarGastos() {
        const lista = document.getElementById("listaGastos");
        if (gastos.length === 0) {
          lista.innerHTML =
            '<p style="color: #999;">No hay gastos registrados</p>';
          return;
        }

        lista.innerHTML = gastos
          .map(
            (gasto) => `
                <div class="expense-item">
                    <div class="expense-info">
                        <span class="expense-category">${gasto.categoria}</span>
                        <strong>${gasto.desc}</strong>
                        <div style="color: #666; font-size: 0.9em; margin-top: 5px;">${gasto.fecha}</div>
                    </div>
                    <div>
                        <div class="expense-amount">$${gasto.monto.toFixed(2)}</div>
                        <button class="btn btn-delete" onclick="eliminarGasto(${gasto.id})">Eliminar</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function eliminarGasto(id) {
        gastos = gastos.filter((g) => g.id !== id);
        mostrarGastos();
        actualizarEstadoPresupuesto();
      }

      // Funciones de Presupuesto
      function establecerPresupuesto() {
        const categoria = document.getElementById("presupuestoCategoria").value;
        const limite = parseFloat(
          document.getElementById("presupuestoLimite").value
        );

        if (!limite) {
          alert("Ingresa un monto v√°lido");
          return;
        }

        presupuestos[categoria] = limite;
        document.getElementById("presupuestoLimite").value = "";
        actualizarEstadoPresupuesto();
      }

      function actualizarEstadoPresupuesto() {
        const mesActual = new Date().getMonth();
        const a√±oActual = new Date().getFullYear();

        const gastosMes = gastos.filter((g) => {
          const fecha = new Date(g.fecha);
          return (
            fecha.getMonth() === mesActual && fecha.getFullYear() === a√±oActual
          );
        });

        const totalGastado = gastosMes.reduce((sum, g) => sum + g.monto, 0);
        const totalPresupuesto = Object.values(presupuestos).reduce(
          (sum, p) => sum + p,
          0
        );

        document.getElementById("presupuestoTotal").textContent =
          `$${totalPresupuesto.toFixed(2)}`;
        document.getElementById("gastadoMes").textContent =
          `$${totalGastado.toFixed(2)}`;
        document.getElementById("disponible").textContent =
          `$${(totalPresupuesto - totalGastado).toFixed(2)}`;

        const container = document.getElementById("estadoPresupuesto");
        if (Object.keys(presupuestos).length === 0) {
          container.innerHTML =
            '<p style="color: #999;">No hay presupuestos configurados</p>';
          return;
        }

        container.innerHTML = Object.entries(presupuestos)
          .map(([cat, limite]) => {
            const gastado = gastosMes
              .filter((g) => g.categoria === cat)
              .reduce((sum, g) => sum + g.monto, 0);
            const porcentaje = (gastado / limite) * 100;
            const alerta =
              porcentaje > 90
                ? "alert-warning"
                : porcentaje > 100
                  ? "alert-warning"
                  : "";

            return `
                    <div class="budget-item">
                        <div style="flex: 1;">
                            <strong>${cat}</strong>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(porcentaje, 100)}%">
                                    ${porcentaje.toFixed(0)}%
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #666;">
                                <span>Gastado: $${gastado.toFixed(2)}</span>
                                <span>L√≠mite: $${limite.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    ${porcentaje > 90 ? `<div class="alert alert-warning" style="margin-top: 10px;">‚ö†Ô∏è Te est√°s acercando al l√≠mite en ${cat}</div>` : ""}
                `;
          })
          .join("");
      }

      function verificarPresupuesto(categoria, monto) {
        if (presupuestos[categoria]) {
          const mesActual = new Date().getMonth();
          const a√±oActual = new Date().getFullYear();
          const gastosCat = gastos.filter((g) => {
            const fecha = new Date(g.fecha);
            return (
              g.categoria === categoria &&
              fecha.getMonth() === mesActual &&
              fecha.getFullYear() === a√±oActual
            );
          });
          const totalGastado = gastosCat.reduce((sum, g) => sum + g.monto, 0);

          if (totalGastado > presupuestos[categoria] * 0.9) {
            alert(
              `‚ö†Ô∏è Alerta: Has gastado el ${((totalGastado / presupuestos[categoria]) * 100).toFixed(0)}% de tu presupuesto en ${categoria}`
            );
          }
        }
      }

      // Funciones de Objetivos
      function agregarObjetivo() {
        const nombre = document.getElementById("objetivoNombre").value;
        const monto = parseFloat(
          document.getElementById("objetivoMonto").value
        );
        const actual = parseFloat(
          document.getElementById("objetivoActual").value
        );
        const fecha = document.getElementById("objetivoFecha").value;
        const prioridad = document.getElementById("objetivoPrioridad").value;

        if (!nombre || !monto || !fecha) {
          alert("Por favor completa todos los campos");
          return;
        }

        const objetivo = {
          nombre,
          monto,
          actual: actual || 0,
          fecha,
          prioridad,
          id: Date.now(),
        };
        objetivos.push(objetivo);

        document.getElementById("objetivoNombre").value = "";
        document.getElementById("objetivoMonto").value = "";
        document.getElementById("objetivoActual").value = "";
        document.getElementById("objetivoFecha").value = "";

        mostrarObjetivos();
      }

      function mostrarObjetivos() {
        const lista = document.getElementById("listaObjetivos");
        if (objetivos.length === 0) {
          lista.innerHTML =
            '<p style="color: #999;">No hay objetivos creados</p>';
          return;
        }

        lista.innerHTML = objetivos
          .map((obj) => {
            const porcentaje = (obj.actual / obj.monto) * 100;
            const prioridadIcon =
              obj.prioridad === "Alta"
                ? "üî¥"
                : obj.prioridad === "Media"
                  ? "üü°"
                  : "üü¢";

            return `
                    <div class="goal-item">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <strong style="font-size: 1.1em;">${obj.nombre}</strong>
                                <span>${prioridadIcon} ${obj.prioridad}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(porcentaje, 100)}%">
                                    ${porcentaje.toFixed(0)}%
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-top: 5px;">
                                <span>Ahorrado: $${obj.actual.toFixed(2)} / $${obj.monto.toFixed(2)}</span>
                                <span>Fecha: ${obj.fecha}</span>
                            </div>
                            <div style="margin-top: 10px;">
                                <input type="number" id="aporte-${obj.id}" placeholder="Agregar aporte" style="padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px; width: 150px; margin-right: 10px;">
                                <button class="btn" style="padding: 8px 16px;" onclick="agregarAporte(${obj.id})">Agregar</button>
                            </div>
                        </div>
                        <div>
                            <div class="goal-amount">Faltan: $${(obj.monto - obj.actual).toFixed(2)}</div>
                            <button class="btn btn-delete" onclick="eliminarObjetivo(${obj.id})">Eliminar</button>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function agregarAporte(id) {
        const input = document.getElementById(`aporte-${id}`);
        const aporte = parseFloat(input.value);

        if (!aporte || aporte <= 0) {
          alert("Ingresa un monto v√°lido");
          return;
        }

        const objetivo = objetivos.find((o) => o.id === id);
        if (objetivo) {
          objetivo.actual += aporte;
          input.value = "";
          mostrarObjetivos();
        }
      }

      function eliminarObjetivo(id) {
        objetivos = objetivos.filter((o) => o.id !== id);
        mostrarObjetivos();
      }

      // Funciones de An√°lisis
      function actualizarAnalisis() {
        const mesActual = new Date().getMonth();
        const a√±oActual = new Date().getFullYear();
        const gastosMes = gastos.filter((g) => {
          const fecha = new Date(g.fecha);
          return (
            fecha.getMonth() === mesActual && fecha.getFullYear() === a√±oActual
          );
        });

        const categorias = {};
        gastosMes.forEach((g) => {
          categorias[g.categoria] = (categorias[g.categoria] || 0) + g.monto;
        });

        const total = Object.values(categorias).reduce(
          (sum, val) => sum + val,
          0
        );
        const chart = document.getElementById("chartGastos");

        if (total === 0) {
          chart.innerHTML =
            '<p style="color: #999;">No hay gastos para analizar este mes</p>';
          return;
        }

        chart.innerHTML = Object.entries(categorias)
          .map(([cat, monto]) => {
            const porcentaje = (monto / total) * 100;
            return `
                    <div class="category-bar">
                        <div class="category-label">
                            <span>${cat}</span>
                            <span>$${monto.toFixed(2)} (${porcentaje.toFixed(1)}%)</span>
                        </div>
                        <div class="bar">
                            <div class="bar-fill" style="width: ${porcentaje}%">
                                ${porcentaje.toFixed(0)}%
                            </div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function calcularViabilidad() {
        const ingreso = parseFloat(
          document.getElementById("ingresoMensual").value
        );
        const fijos = parseFloat(document.getElementById("gastosFijos").value);
        const resultado = document.getElementById("resultadoAnalisis");

        if (!ingreso) {
          alert("Ingresa tu ingreso mensual");
          return;
        }

        const disponible = ingreso - (fijos || 0);
        const mesActual = new Date().getMonth();
        const a√±oActual = new Date().getFullYear();
        const gastosMes = gastos.filter((g) => {
          const fecha = new Date(g.fecha);
          return (
            fecha.getMonth() === mesActual && fecha.getFullYear() === a√±oActual
          );
        });
        const totalGastosVariables = gastosMes.reduce(
          (sum, g) => sum + g.monto,
          0
        );
        const libre = disponible - totalGastosVariables;

        let html = `
                <div class="alert alert-success">
                    <strong>Dinero Libre Mensual:</strong> $${libre.toFixed(2)}
                </div>
            `;

        if (objetivos.length > 0) {
          html +=
            '<h3 style="margin-top: 20px; color: #667eea;">Viabilidad de Objetivos:</h3>';
          objetivos.forEach((obj) => {
            const falta = obj.monto - obj.actual;
            const fechaLimite = new Date(obj.fecha);
            const hoy = new Date();
            const mesesRestantes = Math.max(
              1,
              Math.ceil((fechaLimite - hoy) / (1000 * 60 * 60 * 24 * 30))
            );
            const necesitaMes = falta / mesesRestantes;
            const porcentajeIngreso = (necesitaMes / ingreso) * 100;

            const viable = necesitaMes <= libre;
            const clase = viable ? "alert-success" : "alert-warning";
            const icono = viable ? "‚úÖ" : "‚ö†Ô∏è";

            html += `
                        <div class="alert ${clase}" style="margin-top: 10px;">
                            <strong>${icono} ${obj.nombre}</strong><br>
                            Necesitas ahorrar: ${necesitaMes.toFixed(2)}/mes durante ${mesesRestantes} meses<br>
                            Esto representa el ${porcentajeIngreso.toFixed(1)}% de tu ingreso<br>
                            ${
                              viable
                                ? "¬°Este objetivo es alcanzable con tu ingreso actual!"
                                : "Considera extender el plazo o reducir otros gastos para alcanzar este objetivo."
                            }
                        </div>
                    `;
          });
        }

        const viabilidad = document.getElementById("viabilidadObjetivos");
        if (ingreso && objetivos.length > 0) {
          viabilidad.innerHTML = html;
        }

        resultado.innerHTML = html;
      }

      // Funci√≥n para generar consejos personalizados
      function generarConsejos() {
        const lista = document.getElementById("listaConsejos");
        const consejos = [
          "Registra todos tus gastos diariamente para tener un mejor control.",
          "Establece un presupuesto para cada categor√≠a y resp√©talo.",
          "Intenta ahorrar al menos el 20% de tus ingresos mensuales.",
        ];

        // Analizar gastos para dar consejos personalizados
        if (gastos.length > 0) {
          const mesActual = new Date().getMonth();
          const a√±oActual = new Date().getFullYear();
          const gastosMes = gastos.filter((g) => {
            const fecha = new Date(g.fecha);
            return (
              fecha.getMonth() === mesActual &&
              fecha.getFullYear() === a√±oActual
            );
          });

          const categorias = {};
          gastosMes.forEach((g) => {
            categorias[g.categoria] = (categorias[g.categoria] || 0) + g.monto;
          });

          const total = Object.values(categorias).reduce(
            (sum, val) => sum + val,
            0
          );

          // Consejo por categor√≠a m√°s alta
          if (total > 0) {
            const catMax = Object.entries(categorias).sort(
              (a, b) => b[1] - a[1]
            )[0];
            const porcentaje = ((catMax[1] / total) * 100).toFixed(0);
            if (porcentaje > 40) {
              consejos.push(
                `Tu categor√≠a de mayor gasto es ${catMax[0]} (${porcentaje}%). Considera buscar alternativas m√°s econ√≥micas en esta √°rea.`
              );
            }
          }

          // Consejo sobre presupuestos
          if (Object.keys(presupuestos).length === 0) {
            consejos.push(
              "A√∫n no has establecido presupuestos. Configura l√≠mites para cada categor√≠a para tener mejor control."
            );
          }

          // Consejo sobre entretenimiento
          if (
            categorias["Entretenimiento"] &&
            categorias["Entretenimiento"] / total > 0.25
          ) {
            consejos.push(
              "Tus gastos en entretenimiento representan m√°s del 25% del total. Busca opciones gratuitas o m√°s econ√≥micas de ocio."
            );
          }

          // Consejo sobre comida
          if (categorias["Comida"] && categorias["Comida"] / total > 0.35) {
            consejos.push(
              "Considera preparar m√°s comidas en casa en lugar de comer fuera para reducir gastos en alimentaci√≥n."
            );
          }
        }

        // Consejos sobre objetivos
        if (objetivos.length === 0) {
          consejos.push(
            "No tienes objetivos de ahorro definidos. Establecer metas te ayudar√° a mantener la motivaci√≥n y el enfoque."
          );
        } else if (objetivos.length > 5) {
          consejos.push(
            "Tienes muchos objetivos simult√°neos. Considera priorizar los m√°s importantes para enfocarte mejor."
          );
        }

        // Consejos generales adicionales
        consejos.push(
          "Revisa tus suscripciones mensuales y cancela las que no uses regularmente."
        );
        consejos.push(
          "Usa la regla 50/30/20: 50% para necesidades, 30% para deseos, 20% para ahorros."
        );
        consejos.push(
          'Establece un "d√≠a sin gastos" a la semana para aumentar tus ahorros.'
        );
        consejos.push(
          "Antes de comprar algo, espera 24 horas. Muchas veces la urgencia desaparece."
        );

        lista.innerHTML = consejos
          .map((consejo) => `<li>${consejo}</li>`)
          .join("");
      }

      // Inicializar
      mostrarGastos();
      mostrarObjetivos();
      actualizarEstadoPresupuesto();
    </script>
  </body>
</html>
